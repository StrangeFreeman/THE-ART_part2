{
  "name": "Wazuh Agent Status Check",
  "pinned": false,
  "createdAt": 1768467169563,
  "preset": "@local:wazuh-v3",
  "tokenCount": 5040,
  "userLastMessagedAt": 1768467180644,
  "systemPrompt": "",
  "messages": [
    {
      "versions": [
        {
          "type": "singleStep",
          "role": "user",
          "content": [
            {
              "type": "text",
              "text": "5.\tåˆ—å‡ºç›®å‰æ‰€æœ‰ Wazuh agent çš„ç‹€æ…‹ã€‚"
            }
          ]
        }
      ],
      "currentlySelected": 0
    },
    {
      "versions": [
        {
          "type": "multiStep",
          "role": "assistant",
          "steps": [
            {
              "type": "contentBlock",
              "stepIdentifier": "1768467183016-0.7106467747707147",
              "content": [
                {
                  "type": "text",
                  "text": "\nå¥½çš„ï¼Œç”¨æˆ·éœ€è¦åˆ—å‡ºå½“å‰æ‰€æœ‰Wazuh agentçš„çŠ¶æ€ã€‚é¦–å…ˆï¼Œæˆ‘å¾—ç¡®å®šå“ªä¸ªå·¥å…·èƒ½æä¾›è¿™ä¸ªä¿¡æ¯ã€‚æŸ¥çœ‹å¯ç”¨çš„å‡½æ•°åˆ—è¡¨ï¼Œå‘ç°æœ‰ä¸€ä¸ªå«åšget_wazuh_agentsçš„å‡½æ•°ï¼Œå®ƒçš„æè¿°æ˜¯è·å–Wazuhä»£ç†åˆ—è¡¨ï¼ŒåŒ…æ‹¬çŠ¶æ€ã€IPã€æ“ä½œç³»ç»Ÿè¯¦æƒ…å’Œæœ€åæ´»åŠ¨æ—¶é—´ç­‰ã€‚\n\næ¥ä¸‹æ¥ï¼Œç”¨æˆ·çš„é—®é¢˜æ˜¯è¦åˆ—å‡ºæ‰€æœ‰agentçš„çŠ¶æ€ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚å‚æ•°æ–¹é¢ï¼Œç”¨æˆ·æ²¡æœ‰æŒ‡å®šç‰¹å®šçš„è¿‡æ»¤æ¡ä»¶ï¼Œæ¯”å¦‚ç»„ã€IPæˆ–åç§°ï¼Œä½†å‡½æ•°è¦æ±‚å¿…é¡»æä¾›statuså‚æ•°ã€‚ä¸è¿‡ç”¨æˆ·åªæ˜¯è¦å…¨éƒ¨åˆ—å‡ºï¼Œå¯èƒ½ä¸éœ€è¦è¿‡æ»¤ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦é»˜è®¤å‚æ•°æˆ–è€…å¦‚ä½•å¤„ç†ï¼Ÿ\n\nä»”ç»†çœ‹å‡½æ•°å®šä¹‰ï¼Œå‚æ•°ä¸­çš„statusæ˜¯å¿…å¡«é¡¹ï¼Œç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œå¯é€‰å€¼åŒ…æ‹¬active, disconnected, pending, never_connectedã€‚ä½†æ˜¯ç”¨æˆ·æƒ³è¦æ‰€æœ‰çŠ¶æ€çš„agentï¼Œè¿™æ—¶å€™å¯èƒ½éœ€è¦å¤šæ¬¡è°ƒç”¨å‡½æ•°ï¼Œæ¯æ¬¡ä¼ ä¸åŒçš„statuså€¼ï¼Œæˆ–è€…æ˜¯å¦æœ‰å…¶ä»–æ–¹å¼ï¼Ÿ\n\nä¸è¿‡æ ¹æ®å‡½æ•°æè¿°ï¼Œä¼¼ä¹statusæ˜¯ç”¨äºè¿‡æ»¤çš„ï¼Œæ¯”å¦‚åªè·å–æ´»è·ƒçš„agentã€‚ä½†ç”¨æˆ·è¦çš„æ˜¯å…¨éƒ¨åˆ—å‡ºï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä¸æŒ‡å®šstatuså‚æ•°ï¼Ÿä½†æ ¹æ®requiredå­—æ®µï¼Œstatusæ˜¯å¿…å¡«çš„ï¼Œè¿™å¯èƒ½æ˜¯ä¸ªé—®é¢˜ã€‚è¿™æ—¶å€™å¯èƒ½éœ€è¦æ£€æŸ¥å‡½æ•°æ˜¯å¦å…è®¸statuså‚æ•°ä¸ºç©ºï¼Œæˆ–è€…æ˜¯å¦æœ‰å…¶ä»–æ–¹å¼ã€‚\n\næˆ–è€…ï¼Œå¯èƒ½ç”¨æˆ·çš„é—®é¢˜éœ€è¦è·å–æ‰€æœ‰çŠ¶æ€çš„agentï¼Œå› æ­¤å¯èƒ½éœ€è¦è°ƒç”¨get_wazuh_agentså‡½æ•°ï¼Œå¹¶å°†statuså‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯èƒ½å€¼çš„åˆ—è¡¨ï¼Ÿä½†æ ¹æ®å‡½æ•°å®šä¹‰ï¼Œstatusæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸æ˜¯æ•°ç»„ã€‚è¿™ä¼¼ä¹æœ‰çŸ›ç›¾ã€‚\n\næˆ–è®¸è¿™é‡Œçš„å‡½æ•°è®¾è®¡å¯èƒ½å­˜åœ¨é”™è¯¯ï¼Œæˆ–è€…æˆ‘ç†è§£é”™äº†ã€‚å†ä»”ç»†çœ‹å‡½æ•°å‚æ•°éƒ¨åˆ†ï¼šåœ¨propertiesé‡Œï¼Œstatusæ˜¯å¿…å¡«é¡¹ï¼Œç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œå¯é€‰å€¼æ˜¯å››ä¸ªçŠ¶æ€ã€‚å¦‚æœç”¨æˆ·è¦è·å–æ‰€æœ‰agentçš„çŠ¶æ€ï¼Œä¸ç®¡å…¶å½“å‰çŠ¶æ€å¦‚ä½•ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œåˆ†åˆ«ä¼ å…¥æ¯ä¸ªstatuså€¼ï¼Œç„¶ååˆå¹¶ç»“æœï¼Ÿ\n\næˆ–è€…ï¼Œæ˜¯å¦æœ‰å¯èƒ½ç”¨æˆ·çš„é—®é¢˜å®é™…ä¸Šæ˜¯è¦è·å–æ‰€æœ‰agentçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„statuså­—æ®µï¼Œè€Œä¸éœ€è¦è¿‡æ»¤ï¼Ÿè¿™æ—¶å€™å¯èƒ½éœ€è¦å¿½ç•¥statuså‚æ•°ï¼Œä½†æ ¹æ®requiredå­—æ®µï¼Œå¿…é¡»æä¾›ã€‚è¿™ä¼¼ä¹æ˜¯ä¸ªçŸ›ç›¾ã€‚\n\næ­¤æ—¶ï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥ç¡®è®¤ï¼Œä½†æ ¹æ®ç°æœ‰ä¿¡æ¯ï¼Œåªèƒ½æŒ‰ç…§å‡½æ•°å®šä¹‰æ¥å¤„ç†ã€‚ç”±äºç”¨æˆ·æ²¡æœ‰æŒ‡å®šç‰¹å®šçš„çŠ¶æ€è¿‡æ»¤æ¡ä»¶ï¼Œå¯èƒ½éœ€è¦å°†statuså‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªé»˜è®¤å€¼ï¼Œæ¯”å¦‚\"active\"ï¼Œä½†è¿™å¯èƒ½æ— æ³•æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚æˆ–è€…ï¼Œæ˜¯å¦æœ‰å¯èƒ½è¯¥å‡½æ•°çš„statuså‚æ•°æ˜¯ç”¨äºå…¶ä»–ç”¨é€”ï¼Ÿ\n\nå†ä»”ç»†çœ‹å‡½æ•°æè¿°ï¼šget_wazuh_agentsçš„å‚æ•°ä¸­ï¼Œstatusæ˜¯ç”¨äºè¿‡æ»¤çš„ï¼Œä¾‹å¦‚åªè·å–æ´»è·ƒçš„agentã€‚å¦‚æœç”¨æˆ·è¦åˆ—å‡ºæ‰€æœ‰agentçš„çŠ¶æ€ï¼Œå¯èƒ½éœ€è¦ä¸ä½¿ç”¨statuså‚æ•°ï¼Œä½†æ ¹æ®requiredå­—æ®µï¼Œå¿…é¡»æä¾›ã€‚è¿™ä¼¼ä¹æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚\n\nè¿™æ—¶å€™å¯èƒ½éœ€è¦è”ç³»å¼€å‘äººå‘˜ç¡®è®¤ï¼Œä½†åœ¨å½“å‰æƒ…å†µä¸‹ï¼Œåªèƒ½æŒ‰ç…§ç°æœ‰å‡½æ•°å®šä¹‰å¤„ç†ã€‚æˆ–è®¸ç”¨æˆ·çš„é—®é¢˜å®é™…ä¸Šæ˜¯è¦è·å–æ‰€æœ‰agentçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„statuså­—æ®µï¼Œè€Œä¸ç®¡çŠ¶æ€å¦‚ä½•ã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦å°†statuså‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªé»˜è®¤å€¼ï¼Œæ¯”å¦‚\"active\"ï¼Œä½†è¿™æ ·ä¼šé—æ¼å…¶ä»–çŠ¶æ€çš„agentã€‚\n\næˆ–è€…ï¼Œæ˜¯å¦æœ‰å¯èƒ½è¯¥å‡½æ•°çš„statuså‚æ•°æ˜¯å¿…å¡«çš„ï¼Œä½†å…è®¸ä½¿ç”¨é€šé…ç¬¦æˆ–ç‰¹æ®Šå€¼æ¥è·å–æ‰€æœ‰ï¼Ÿä¾‹å¦‚ï¼Œä¼ å…¥ç©ºå­—ç¬¦ä¸²æˆ–å…¶ä»–ç‰¹å®šå€¼ï¼Ÿ\n\nç”±äºæ— æ³•ç¡®å®šï¼Œå¯èƒ½éœ€è¦å‡è®¾ç”¨æˆ·å¸Œæœ›è·å–æ‰€æœ‰agentçš„çŠ¶æ€ä¿¡æ¯ï¼Œå› æ­¤å¯èƒ½éœ€è¦è°ƒç”¨get_wazuh_agentså‡½æ•°ï¼Œå¹¶å°†statuså‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªé»˜è®¤å€¼ï¼Œæ¯”å¦‚\"active\"ï¼ŒåŒæ—¶æŒ‡å‡ºè¿™å¯èƒ½ä¼šé—æ¼å…¶ä»–çŠ¶æ€çš„agentã€‚ä½†æ ¹æ®é—®é¢˜æè¿°ï¼Œç”¨æˆ·æ˜ç¡®è¦æ±‚åˆ—å‡ºâ€œç›®å‰æ‰€æœ‰â€agentçš„çŠ¶æ€ï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿è·å–åˆ°æ‰€æœ‰ã€‚\n\næ­¤æ—¶ï¼Œå¯èƒ½è¯¥å‡½æ•°çš„è®¾è®¡å­˜åœ¨ç¼ºé™·ï¼Œæˆ–è€…æˆ‘ç†è§£æœ‰è¯¯ã€‚å†ä»”ç»†çœ‹å‡½æ•°å®šä¹‰ä¸­çš„requiredå­—æ®µï¼Œstatusæ˜¯å¿…å¡«é¡¹ï¼Œå› æ­¤å¿…é¡»æä¾›ä¸€ä¸ªå€¼ã€‚è¿™å¯èƒ½æ„å‘³ç€è¯¥å‡½æ•°åªèƒ½è¿‡æ»¤ç‰¹å®šçŠ¶æ€çš„agentï¼Œè€Œæ— æ³•è·å–å…¨éƒ¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„é—®é¢˜å¯èƒ½éœ€è¦å¤šæ¬¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œåˆ†åˆ«ä¼ å…¥æ¯ä¸ªå¯èƒ½çš„çŠ¶æ€å€¼ï¼Œç„¶ååˆå¹¶ç»“æœã€‚\n\nä¾‹å¦‚ï¼Œå…ˆä¼ å…¥\"active\"ï¼Œå†ä¼ å…¥\"disconnected\"ï¼Œä¾æ­¤ç±»æ¨ï¼Œæœ€åå°†æ‰€æœ‰ç»“æœæ±‡æ€»ã€‚ä½†æ ¹æ®å·¥å…·è°ƒç”¨çš„è§„åˆ™ï¼Œæ¯æ¬¡åªèƒ½è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå› æ­¤å¯èƒ½æ— æ³•åœ¨å•æ¬¡è¯·æ±‚ä¸­å®Œæˆã€‚è¿™å¯èƒ½å¯¼è‡´ç”¨æˆ·çš„é—®é¢˜æ— æ³•å®Œå…¨æ»¡è¶³ï¼Œé™¤éæœ‰å…¶ä»–æ–¹æ³•ã€‚\n\nç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨ç°æœ‰å‡½æ•°å®šä¹‰ä¸‹ï¼Œæ— æ³•ç›´æ¥è·å–æ‰€æœ‰agentçš„çŠ¶æ€ä¿¡æ¯ï¼Œå› ä¸ºstatuså‚æ•°æ˜¯å¿…å¡«ä¸”ç”¨äºè¿‡æ»¤ã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦æç¤ºç”¨æˆ·æä¾›æ›´å…·ä½“çš„è¿‡æ»¤æ¡ä»¶ï¼Œæˆ–è€…æŒ‡å‡ºè¯¥é™åˆ¶ã€‚ä½†æ ¹æ®é—®é¢˜æè¿°ï¼Œç”¨æˆ·åªæ˜¯è¦åˆ—å‡ºæ‰€æœ‰agentçš„çŠ¶æ€ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦è°ƒç”¨get_wazuh_agentså‡½æ•°ï¼Œå¹¶å°†statuså‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªé»˜è®¤å€¼ï¼ŒåŒæ—¶è¯´æ˜è¿™å¯èƒ½ä¼šé—æ¼æŸäº›çŠ¶æ€çš„agentã€‚\n\nä¸è¿‡ï¼Œåœ¨å®é™…æƒ…å†µä¸­ï¼Œå¯èƒ½Wazuh APIå…è®¸é€šè¿‡å…¶ä»–æ–¹å¼è·å–æ‰€æœ‰agentçš„ä¿¡æ¯ï¼Œä¾‹å¦‚ä¸æŒ‡å®šstatuså‚æ•°ã€‚ä½†æ ¹æ®å½“å‰æä¾›çš„å‡½æ•°å®šä¹‰ï¼Œå¿…é¡»æä¾›statuså‚æ•°ã€‚å› æ­¤ï¼Œè¿™é‡Œå¯èƒ½å­˜åœ¨çŸ›ç›¾ï¼Œéœ€è¦è¿›ä¸€æ­¥ç¡®è®¤ã€‚ä½†åœ¨æ— æ³•è”ç³»å¼€å‘äººå‘˜çš„æƒ…å†µä¸‹ï¼Œåªèƒ½æŒ‰ç…§ç°æœ‰ä¿¡æ¯å¤„ç†ã€‚\n",
                  "fromDraftModel": false,
                  "tokensCount": 1014,
                  "isStructural": false
                }
              ],
              "defaultShouldIncludeInContext": true,
              "shouldIncludeInContext": true,
              "style": {
                "type": "thinking",
                "ended": true,
                "title": "Thought for 20.35 seconds",
                "forceRenderAsPlainText": false
              },
              "prefix": "<think>",
              "suffix": "</think>"
            },
            {
              "type": "contentBlock",
              "stepIdentifier": "1768467203401-0.20743246766766832",
              "content": [
                {
                  "type": "text",
                  "text": "\n\n",
                  "fromDraftModel": false,
                  "tokensCount": 1,
                  "isStructural": false
                },
                {
                  "type": "toolCallRequest",
                  "callId": 277651728080374,
                  "toolCallRequestId": "592815678",
                  "name": "get_wazuh_agents",
                  "parameters": {
                    "status": "active"
                  },
                  "pluginIdentifier": "mcp/wazuh"
                },
                {
                  "type": "text",
                  "text": "\n",
                  "fromDraftModel": false,
                  "tokensCount": 1,
                  "isStructural": false
                },
                {
                  "type": "toolCallRequest",
                  "callId": 277651728080375,
                  "toolCallRequestId": "620211070",
                  "name": "get_wazuh_agents",
                  "parameters": {
                    "status": "disconnected"
                  },
                  "pluginIdentifier": "mcp/wazuh"
                },
                {
                  "type": "text",
                  "text": "\n",
                  "fromDraftModel": false,
                  "tokensCount": 1,
                  "isStructural": false
                },
                {
                  "type": "toolCallRequest",
                  "callId": 277651728080376,
                  "toolCallRequestId": "303906424",
                  "name": "get_wazuh_agents",
                  "parameters": {
                    "status": "pending"
                  },
                  "pluginIdentifier": "mcp/wazuh"
                },
                {
                  "type": "text",
                  "text": "\n",
                  "fromDraftModel": false,
                  "tokensCount": 1,
                  "isStructural": false
                },
                {
                  "type": "toolCallRequest",
                  "callId": 277651728080377,
                  "toolCallRequestId": "397697428",
                  "name": "get_wazuh_agents",
                  "parameters": {
                    "status": "never_connected"
                  },
                  "pluginIdentifier": "mcp/wazuh"
                }
              ],
              "defaultShouldIncludeInContext": true,
              "shouldIncludeInContext": true,
              "genInfo": {
                "indexedModelIdentifier": "qwen/qwen3-8b",
                "identifier": "qwen/qwen3-8b",
                "loadModelConfig": {
                  "fields": [
                    {
                      "key": "llm.load.llama.cpuThreadPoolSize",
                      "value": 4
                    },
                    {
                      "key": "llm.load.contextLength",
                      "value": 10000
                    },
                    {
                      "key": "llm.load.llama.flashAttention",
                      "value": true
                    },
                    {
                      "key": "llm.load.llama.acceleration.offloadRatio",
                      "value": 1
                    }
                  ]
                },
                "predictionConfig": {
                  "fields": [
                    {
                      "key": "llm.prediction.promptTemplate",
                      "value": {
                        "type": "jinja",
                        "jinjaPromptTemplate": {
                          "template": "{%- if tools %}\n    {{- '<|im_start|>system\\n' }}\n    {%- if messages[0].role == 'system' %}\n        {{- messages[0].content + '\\n\\n' }}\n    {%- endif %}\n    {{- \"# Tools\\n\\nYou may call one or more functions to assist with the user query.\\n\\nYou are provided with function signatures within <tools></tools> XML tags:\\n<tools>\" }}\n    {%- for tool in tools %}\n        {{- \"\\n\" }}\n        {{- tool | tojson }}\n    {%- endfor %}\n    {{- \"\\n</tools>\\n\\nFor each function call, return a json object with function name and arguments within <tool_call></tool_call> XML tags:\\n<tool_call>\\n{\\\"name\\\": <function-name>, \\\"arguments\\\": <args-json-object>}\\n</tool_call><|im_end|>\\n\" }}\n{%- else %}\n    {%- if messages[0].role == 'system' %}\n        {{- '<|im_start|>system\\n' + messages[0].content + '<|im_end|>\\n' }}\n    {%- endif %}\n{%- endif %}\n{%- set ns = namespace(multi_step_tool=true, last_query_index=messages|length - 1) %}\n{%- for message in messages[::-1] %}\n    {%- set index = (messages|length - 1) - loop.index0 %}\n    {%- set tool_start = \"<tool_response>\" %}\n    {%- set tool_start_length = tool_start|length %}\n    {%- set start_of_message = message.content[:tool_start_length] %}\n    {%- set tool_end = \"</tool_response>\" %}\n    {%- set tool_end_length = tool_end|length %}\n    {%- set start_pos = (message.content|length) - tool_end_length %}\n    {%- if start_pos < 0 %}\n        {%- set start_pos = 0 %}\n    {%- endif %}\n    {%- set end_of_message = message.content[start_pos:] %}\n    {%- if ns.multi_step_tool and message.role == \"user\" and not(start_of_message == tool_start and end_of_message == tool_end) %}\n        {%- set ns.multi_step_tool = false %}\n        {%- set ns.last_query_index = index %}\n    {%- endif %}\n{%- endfor %}\n{%- for message in messages %}\n    {%- if (message.role == \"user\") or (message.role == \"system\" and not loop.first) %}\n        {{- '<|im_start|>' + message.role + '\\n' + message.content + '<|im_end|>' + '\\n' }}\n    {%- elif message.role == \"assistant\" %}\n        {%- set content = message.content %}\n        {%- set reasoning_content = '' %}\n        {%- if message.reasoning_content is defined and message.reasoning_content is not none %}\n            {%- set reasoning_content = message.reasoning_content %}\n        {%- else %}\n            {%- if '</think>' in message.content %}\n                {%- set content = (message.content.split('</think>')|last).lstrip('\\n') %}\n        {%- set reasoning_content = (message.content.split('</think>')|first).rstrip('\\n') %}\n        {%- set reasoning_content = (reasoning_content.split('<think>')|last).lstrip('\\n') %}\n            {%- endif %}\n        {%- endif %}\n        {%- if loop.index0 > ns.last_query_index %}\n            {%- if loop.last or (not loop.last and reasoning_content) %}\n                {{- '<|im_start|>' + message.role + '\\n<think>\\n' + reasoning_content.strip('\\n') + '\\n</think>\\n\\n' + content.lstrip('\\n') }}\n            {%- else %}\n                {{- '<|im_start|>' + message.role + '\\n' + content }}\n            {%- endif %}\n        {%- else %}\n            {{- '<|im_start|>' + message.role + '\\n' + content }}\n        {%- endif %}\n        {%- if message.tool_calls %}\n            {%- for tool_call in message.tool_calls %}\n                {%- if (loop.first and content) or (not loop.first) %}\n                    {{- '\\n' }}\n                {%- endif %}\n                {%- if tool_call.function %}\n                    {%- set tool_call = tool_call.function %}\n                {%- endif %}\n                {{- '<tool_call>\\n{\"name\": \"' }}\n                {{- tool_call.name }}\n                {{- '\", \"arguments\": ' }}\n                {%- if tool_call.arguments is string %}\n                    {{- tool_call.arguments }}\n                {%- else %}\n                    {{- tool_call.arguments | tojson }}\n                {%- endif %}\n                {{- '}\\n</tool_call>' }}\n            {%- endfor %}\n        {%- endif %}\n        {{- '<|im_end|>\\n' }}\n    {%- elif message.role == \"tool\" %}\n        {%- if loop.first or (messages[loop.index0 - 1].role != \"tool\") %}\n            {{- '<|im_start|>user' }}\n        {%- endif %}\n        {{- '\\n<tool_response>\\n' }}\n        {{- message.content }}\n        {{- '\\n</tool_response>' }}\n        {%- if loop.last or (messages[loop.index0 + 1].role != \"tool\") %}\n            {{- '<|im_end|>\\n' }}\n        {%- endif %}\n    {%- endif %}\n{%- endfor %}\n{%- if add_generation_prompt %}\n    {{- '<|im_start|>assistant\\n' }}\n    {%- if enable_thinking is defined and enable_thinking is false %}\n        {{- '<think>\\n\\n</think>\\n\\n' }}\n    {%- endif %}\n{%- endif %}"
                        },
                        "stopStrings": []
                      }
                    },
                    {
                      "key": "llm.prediction.llama.cpuThreads",
                      "value": 4
                    },
                    {
                      "key": "llm.prediction.contextPrefill",
                      "value": []
                    },
                    {
                      "key": "llm.prediction.topKSampling",
                      "value": 20
                    },
                    {
                      "key": "llm.prediction.minPSampling",
                      "value": {
                        "checked": true,
                        "value": 0
                      }
                    },
                    {
                      "key": "ext.virtualModel.customField.qwen.qwen38b.enableThinking",
                      "value": true
                    },
                    {
                      "key": "llm.prediction.temperature",
                      "value": 0.4
                    },
                    {
                      "key": "llm.prediction.tools",
                      "value": {
                        "type": "toolArray",
                        "tools": [
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_log_collector_stats",
                              "description": "Retrieves log collector statistics for a specific Wazuh agent. Returns information about events processed, dropped, bytes, and target log files.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to get log collector stats for (required, e.g., \"0\", \"1\", \"001\")",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "agent_id"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "search_wazuh_manager_logs",
                              "description": "Searches Wazuh manager logs. Returns formatted log entries including timestamp, tag, level, and description. Supports filtering by limit, offset, level, tag, and a search term.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "level": {
                                    "description": "Log level to filter by (e.g., \"error\", \"warning\", \"info\")",
                                    "type": "string"
                                  },
                                  "limit": {
                                    "description": "Maximum number of log entries to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "offset": {
                                    "description": "Number of log entries to skip (default: 0)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "search_term": {
                                    "description": "Search term to filter log descriptions (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "tag": {
                                    "description": "Log tag to filter by (e.g., \"wazuh-modulesd\") (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "level"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_alert_summary",
                              "description": "Retrieves a summary of Wazuh security alerts. Returns formatted alert information including ID, timestamp, and description.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "limit": {
                                    "description": "Maximum number of alerts to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_manager_error_logs",
                              "description": "Retrieves Wazuh manager error logs. Returns formatted log entries including timestamp, tag, level (error), and description.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "limit": {
                                    "description": "Maximum number of error log entries to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_remoted_stats",
                              "description": "Retrieves statistics from the Wazuh remoted daemon. Returns information about queue size, TCP sessions, event counts, and message traffic.",
                              "parameters": {
                                "type": "object",
                                "properties": {}
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_agents",
                              "description": "Retrieves a list of Wazuh agents with their current status and details. Returns formatted agent information including ID, name, IP, status, OS details, and last activity. Supports filtering by status, name, IP, group, OS platform, and version.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "group": {
                                    "description": "Agent group to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "ip": {
                                    "description": "Agent IP address to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "limit": {
                                    "description": "Maximum number of agents to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "name": {
                                    "description": "Agent name to search for (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "os_platform": {
                                    "description": "Operating system platform to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "status": {
                                    "description": "Agent status filter (active, disconnected, pending, never_connected)",
                                    "type": "string"
                                  },
                                  "version": {
                                    "description": "Agent version to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "status"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_agent_ports",
                              "description": "Retrieves a list of open network ports for a specific Wazuh agent. Returns formatted port information including local/remote IP and port, protocol, state, and associated process/PID. Supports filtering by protocol and state.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to get network ports for (required, e.g., \"001\", \"002\", \"003\")",
                                    "type": "string"
                                  },
                                  "limit": {
                                    "description": "Maximum number of ports to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "protocol": {
                                    "description": "Protocol to filter by (e.g., \"tcp\", \"udp\")",
                                    "type": "string"
                                  },
                                  "state": {
                                    "description": "State to filter by (e.g., \"LISTENING\", \"ESTABLISHED\")",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "agent_id",
                                  "protocol",
                                  "state"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_weekly_stats",
                              "description": "Retrieves weekly statistics from the Wazuh manager. Returns a JSON object detailing various metrics aggregated over the past week.",
                              "parameters": {
                                "type": "object",
                                "properties": {}
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_agent_processes",
                              "description": "Retrieves a list of running processes for a specific Wazuh agent. Returns formatted process information including PID, name, state, user, and command. Supports filtering by process name/command.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to get processes for (required, e.g., \"0\", \"1\", \"001\")",
                                    "type": "string"
                                  },
                                  "limit": {
                                    "description": "Maximum number of processes to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "search": {
                                    "description": "Search string to filter processes by name or command (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "agent_id"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_cluster_health",
                              "description": "Checks the health of the Wazuh cluster. Returns whether the cluster is enabled, running, and if nodes are connected.",
                              "parameters": {
                                "type": "object",
                                "properties": {}
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_cluster_nodes",
                              "description": "Retrieves a list of nodes in the Wazuh cluster. Returns formatted node information including name, type, version, IP, and status. Supports filtering by limit, offset, and node type.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "limit": {
                                    "description": "Maximum number of nodes to retrieve (optional, Wazuh API default is 500)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "node_type": {
                                    "description": "Filter by node type (e.g., 'master', 'worker') (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "offset": {
                                    "description": "Number of nodes to skip (offset) (optional, default: 0)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_critical_vulnerabilities",
                              "description": "Retrieves critical vulnerabilities for a specific Wazuh agent. Returns formatted vulnerability information including CVE ID, title, description, CVSS scores, and detection details. Only shows vulnerabilities with 'Critical' severity level.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to get critical vulnerabilities for (required, e.g., \"0\", \"1\", \"001\")",
                                    "type": "string"
                                  },
                                  "limit": {
                                    "description": "Maximum number of vulnerabilities to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "agent_id"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_rules_summary",
                              "description": "Retrieves a summary of Wazuh security rules. Returns formatted rule information including ID, level, description, and groups. Supports filtering by level, group, and filename.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "filename": {
                                    "description": "Filename to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "group": {
                                    "description": "Rule group to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "level": {
                                    "description": "Rule level to filter by (optional)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "limit": {
                                    "description": "Maximum number of rules to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_vulnerability_summary",
                              "description": "Retrieves a summary of Wazuh vulnerability detections for a specific agent. Returns formatted vulnerability information including CVE ID, severity, detection time, and agent details. Supports filtering by severity level.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to filter vulnerabilities by (required, e.g., \"0\", \"1\", \"001\")",
                                    "type": "string"
                                  },
                                  "cve": {
                                    "description": "CVE ID to search for (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "limit": {
                                    "description": "Maximum number of vulnerabilities to retrieve (default: 10000)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "severity": {
                                    "description": "Severity level to filter by (Low, Medium, High, Critical) (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "agent_id"
                                ]
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                },
                "stats": {
                  "stopReason": "eosFound",
                  "tokensPerSecond": 49.514591876689536,
                  "numGpuLayers": -1,
                  "timeToFirstTokenSec": 1.589,
                  "totalTimeSec": 22.438,
                  "promptTokensCount": 2679,
                  "predictedTokensCount": 1111,
                  "totalTokensCount": 3790
                }
              }
            },
            {
              "type": "toolStatus",
              "stepIdentifier": "1768467203601-0.5202604812082223",
              "callId": 277651728080374,
              "statusState": {
                "status": {
                  "type": "toolCallSucceeded",
                  "timeMs": 444
                },
                "customStatus": "",
                "customWarnings": []
              }
            },
            {
              "type": "toolStatus",
              "stepIdentifier": "1768467204071-0.6588173799666314",
              "callId": 277651728080375,
              "statusState": {
                "status": {
                  "type": "toolCallSucceeded",
                  "timeMs": 38
                },
                "customStatus": "",
                "customWarnings": []
              }
            },
            {
              "type": "contentBlock",
              "stepIdentifier": "1768467204279-0.8912436810647538",
              "content": [
                {
                  "type": "toolCallResult",
                  "callId": 277651728080374,
                  "toolCallRequestId": "592815678",
                  "name": "get_wazuh_agents",
                  "content": "[{\"type\":\"text\",\"text\":\"Agent ID: 000 (Wazuh Manager)\\nName: rsa\\nStatus: ğŸŸ¢ ACTIVE\\nIP: 127.0.0.1\\nOS: Ubuntu 24.04.3 LTS (x86_64)\\nAgent Version: Wazuh v4.13.1\\nLast Keep Alive: 9999-12-31T23:59:59+00:00\\nRegistered: 2025-10-08T10:58:00+00:00\\nNode: node01\\nConfig Status: âœ… SYNCED\"},{\"type\":\"text\",\"text\":\"Agent ID: 002\\nName: opnsense-wazuh-go\\nStatus: ğŸŸ¢ ACTIVE\\nIP: 10.2.26.24\\nRegistered IP: any\\nOS: BSD 14.3 (amd64)\\nAgent Version: Wazuh v4.12.0\\nGroups: default\\nLast Keep Alive: 2026-01-15T08:53:18+00:00\\nRegistered: 2025-10-29T06:04:46+00:00\\nNode: node01\\nConfig Status: âœ… SYNCED\"},{\"type\":\"text\",\"text\":\"Agent ID: 003\\nName: windows-go2\\nStatus: ğŸŸ¢ ACTIVE\\nIP: 192.168.114.128\\nRegistered IP: any\\nOS: Microsoft Windows 10 Pro 10.0.19045.6456\\nAgent Version: Wazuh v4.13.1\\nGroups: default\\nLast Keep Alive: 2026-01-15T08:53:11+00:00\\nRegistered: 2025-12-02T09:49:14+00:00\\nNode: node01\\nConfig Status: âœ… SYNCED\"}]"
                }
              ],
              "roleOverride": "tool",
              "defaultShouldIncludeInContext": true,
              "shouldIncludeInContext": true
            },
            {
              "type": "contentBlock",
              "stepIdentifier": "1768467204351-0.2553980415125965",
              "content": [
                {
                  "type": "toolCallResult",
                  "callId": 277651728080375,
                  "toolCallRequestId": "620211070",
                  "name": "get_wazuh_agents",
                  "content": "[{\"type\":\"text\",\"text\":\"Agent ID: 001\\nName: windows-go\\nStatus: ğŸ”´ DISCONNECTED\\nIP: 10.100.2.2\\nRegistered IP: any\\nOS: Microsoft Windows 10 Pro 10.0.19045.6456\\nAgent Version: Wazuh v4.13.1\\nGroups: default\\nLast Keep Alive: 2025-12-02T09:41:22+00:00\\nRegistered: 2025-10-29T05:10:00+00:00\\nNode: node01\\nConfig Status: âœ… SYNCED\"}]"
                }
              ],
              "roleOverride": "tool",
              "defaultShouldIncludeInContext": true,
              "shouldIncludeInContext": true
            },
            {
              "type": "toolStatus",
              "stepIdentifier": "1768467204548-0.15370432856582372",
              "callId": 277651728080376,
              "statusState": {
                "status": {
                  "type": "toolCallSucceeded",
                  "timeMs": 37
                },
                "customStatus": "",
                "customWarnings": []
              }
            },
            {
              "type": "contentBlock",
              "stepIdentifier": "1768467204813-0.33521297971608766",
              "content": [
                {
                  "type": "toolCallResult",
                  "callId": 277651728080376,
                  "toolCallRequestId": "303906424",
                  "name": "get_wazuh_agents",
                  "content": "[{\"type\":\"text\",\"text\":\"No Wazuh agents matching the specified criteria (status: pending) found matching the specified criteria.\"}]"
                }
              ],
              "roleOverride": "tool",
              "defaultShouldIncludeInContext": true,
              "shouldIncludeInContext": true
            },
            {
              "type": "toolStatus",
              "stepIdentifier": "1768467205004-0.004754543440344983",
              "callId": 277651728080377,
              "statusState": {
                "status": {
                  "type": "toolCallSucceeded",
                  "timeMs": 36
                },
                "customStatus": "",
                "customWarnings": []
              }
            },
            {
              "type": "contentBlock",
              "stepIdentifier": "1768467205288-0.030159034829183473",
              "content": [
                {
                  "type": "toolCallResult",
                  "callId": 277651728080377,
                  "toolCallRequestId": "397697428",
                  "name": "get_wazuh_agents",
                  "content": "[{\"type\":\"text\",\"text\":\"No Wazuh agents matching the specified criteria (status: never_connected) found matching the specified criteria.\"}]"
                }
              ],
              "roleOverride": "tool",
              "defaultShouldIncludeInContext": true,
              "shouldIncludeInContext": true
            },
            {
              "type": "contentBlock",
              "stepIdentifier": "1768467206118-0.757236989368435",
              "content": [
                {
                  "type": "text",
                  "text": "\nå¥½çš„ï¼Œç”¨æˆ·éœ€è¦åˆ—å‡ºæ‰€æœ‰Wazuh agentçš„çŠ¶æ€ã€‚æˆ‘ä¹‹å‰è°ƒç”¨äº†å››ä¸ªä¸åŒçš„å‡½æ•°ï¼Œåˆ†åˆ«æŸ¥è¯¢äº†activeã€disconnectedã€pendingå’Œnever_connectedçŠ¶æ€çš„agentã€‚ç°åœ¨éœ€è¦å°†è¿™äº›ç»“æœæ•´åˆèµ·æ¥ï¼Œç»™å‡ºä¸€ä¸ªå®Œæ•´çš„åˆ—è¡¨ã€‚\n\né¦–å…ˆï¼Œæ£€æŸ¥æ¯ä¸ªtool_responseçš„å†…å®¹ã€‚ç¬¬ä¸€ä¸ªå“åº”è¿”å›äº†ä¸‰ä¸ªactiveçš„agentï¼ŒåŒ…æ‹¬Wazuh Manageræœ¬èº«ï¼ˆID 000ï¼‰ï¼Œä»¥åŠä¸¤ä¸ªå…¶ä»–æ´»è·ƒçš„agentï¼ˆ002å’Œ003ï¼‰ã€‚ç¬¬äºŒä¸ªå“åº”æ˜¾ç¤ºäº†ä¸€ä¸ªdisconnectedçš„agentï¼ˆ001ï¼‰ã€‚ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªå“åº”éƒ½è¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°pendingæˆ–never_connectedçŠ¶æ€çš„agentã€‚\n\næ¥ä¸‹æ¥ï¼Œéœ€è¦å°†è¿™äº›ä¿¡æ¯æ±‡æ€»ã€‚æ³¨æ„Wazuh Manageré€šå¸¸ä¸è¢«è§†ä¸ºæ™®é€šagentï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ç‰¹åˆ«è¯´æ˜ã€‚ç„¶åï¼Œåˆ—å‡ºæ‰€æœ‰activeå’Œdisconnectedçš„agentï¼ŒåŒæ—¶æŒ‡å‡ºå…¶ä»–çŠ¶æ€ä¸å­˜åœ¨ã€‚ç¡®ä¿æ¯ä¸ªagentçš„ä¿¡æ¯åŒ…æ‹¬IDã€åç§°ã€çŠ¶æ€ã€IPç­‰å…³é”®å­—æ®µï¼Œå¹¶ä¿æŒæ ¼å¼æ¸…æ™°æ˜“è¯»ã€‚\n\næœ€åï¼Œç¡®è®¤æ˜¯å¦è¿˜æœ‰é—æ¼ï¼Œæ¯”å¦‚æ˜¯å¦æœ‰å…¶ä»–çŠ¶æ€æˆ–agentæœªè¢«åŒ…å«ã€‚æ ¹æ®å·¥å…·è°ƒç”¨ç»“æœï¼Œç›®å‰åªæœ‰è¿™å››ä¸ªçŠ¶æ€çš„æŸ¥è¯¢ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šæ‰€æœ‰agentçš„çŠ¶æ€å·²ç»è¦†ç›–ã€‚æ•´ç†æˆç”¨æˆ·å‹å¥½çš„æ ¼å¼ï¼Œä½¿ç”¨ç¬¦å·å¦‚ğŸŸ¢å’ŒğŸ”´è¡¨ç¤ºçŠ¶æ€ï¼Œå¹¶åˆ†ç‚¹åˆ—å‡ºæ¯ä¸ªagentçš„ä¿¡æ¯ã€‚\n",
                  "fromDraftModel": false,
                  "tokensCount": 252,
                  "isStructural": false
                }
              ],
              "defaultShouldIncludeInContext": true,
              "shouldIncludeInContext": true,
              "style": {
                "type": "thinking",
                "ended": true,
                "title": "Thought for 5.11 seconds",
                "forceRenderAsPlainText": false
              },
              "prefix": "<think>",
              "suffix": "</think>"
            },
            {
              "type": "contentBlock",
              "stepIdentifier": "1768467211379-0.509792179533248",
              "content": [
                {
                  "type": "text",
                  "text": "\n\nä»¥ä¸‹æ˜¯ç›®å‰æ‰€æœ‰ Wazuh agent çš„ç‹€æ…‹æ¸…å–®ï¼š\n\nğŸŸ¢ **ACTIVE**  \n- Agent ID: 000 (Wazuh Manager)  \n  Name: rsa | IP: 127.0.0.1 | OS: Ubuntu 24.04.3 LTS | Last Keep Alive: 9999-12-31  \n\n- Agent ID: 002  \n  Name: opnsense-wazuh-go | IP: 10.2.26.24 | OS: BSD 14.3 | Last Keep Alive: 2026-01-15  \n\n- Agent ID: 003  \n  Name: windows-go2 | IP: 192.168.114.128 | OS: Windows 10 Pro | Last Keep Alive: 2026-01-15  \n\nğŸ”´ **DISCONNECTED**  \n- Agent ID: 001  \n  Name: windows-go | IP: 10.100.2.2 | OS: Windows 10 Pro | Last Keep Alive: 2025-12-02  \n\nç›®å‰ç„¡ Pending æˆ– Never Connected çš„ Agentã€‚",
                  "fromDraftModel": false,
                  "tokensCount": 267,
                  "isStructural": false
                }
              ],
              "defaultShouldIncludeInContext": true,
              "shouldIncludeInContext": true,
              "genInfo": {
                "indexedModelIdentifier": "qwen/qwen3-8b",
                "identifier": "qwen/qwen3-8b",
                "loadModelConfig": {
                  "fields": [
                    {
                      "key": "llm.load.llama.cpuThreadPoolSize",
                      "value": 4
                    },
                    {
                      "key": "llm.load.contextLength",
                      "value": 10000
                    },
                    {
                      "key": "llm.load.llama.flashAttention",
                      "value": true
                    },
                    {
                      "key": "llm.load.llama.acceleration.offloadRatio",
                      "value": 1
                    }
                  ]
                },
                "predictionConfig": {
                  "fields": [
                    {
                      "key": "llm.prediction.promptTemplate",
                      "value": {
                        "type": "jinja",
                        "jinjaPromptTemplate": {
                          "template": "{%- if tools %}\n    {{- '<|im_start|>system\\n' }}\n    {%- if messages[0].role == 'system' %}\n        {{- messages[0].content + '\\n\\n' }}\n    {%- endif %}\n    {{- \"# Tools\\n\\nYou may call one or more functions to assist with the user query.\\n\\nYou are provided with function signatures within <tools></tools> XML tags:\\n<tools>\" }}\n    {%- for tool in tools %}\n        {{- \"\\n\" }}\n        {{- tool | tojson }}\n    {%- endfor %}\n    {{- \"\\n</tools>\\n\\nFor each function call, return a json object with function name and arguments within <tool_call></tool_call> XML tags:\\n<tool_call>\\n{\\\"name\\\": <function-name>, \\\"arguments\\\": <args-json-object>}\\n</tool_call><|im_end|>\\n\" }}\n{%- else %}\n    {%- if messages[0].role == 'system' %}\n        {{- '<|im_start|>system\\n' + messages[0].content + '<|im_end|>\\n' }}\n    {%- endif %}\n{%- endif %}\n{%- set ns = namespace(multi_step_tool=true, last_query_index=messages|length - 1) %}\n{%- for message in messages[::-1] %}\n    {%- set index = (messages|length - 1) - loop.index0 %}\n    {%- set tool_start = \"<tool_response>\" %}\n    {%- set tool_start_length = tool_start|length %}\n    {%- set start_of_message = message.content[:tool_start_length] %}\n    {%- set tool_end = \"</tool_response>\" %}\n    {%- set tool_end_length = tool_end|length %}\n    {%- set start_pos = (message.content|length) - tool_end_length %}\n    {%- if start_pos < 0 %}\n        {%- set start_pos = 0 %}\n    {%- endif %}\n    {%- set end_of_message = message.content[start_pos:] %}\n    {%- if ns.multi_step_tool and message.role == \"user\" and not(start_of_message == tool_start and end_of_message == tool_end) %}\n        {%- set ns.multi_step_tool = false %}\n        {%- set ns.last_query_index = index %}\n    {%- endif %}\n{%- endfor %}\n{%- for message in messages %}\n    {%- if (message.role == \"user\") or (message.role == \"system\" and not loop.first) %}\n        {{- '<|im_start|>' + message.role + '\\n' + message.content + '<|im_end|>' + '\\n' }}\n    {%- elif message.role == \"assistant\" %}\n        {%- set content = message.content %}\n        {%- set reasoning_content = '' %}\n        {%- if message.reasoning_content is defined and message.reasoning_content is not none %}\n            {%- set reasoning_content = message.reasoning_content %}\n        {%- else %}\n            {%- if '</think>' in message.content %}\n                {%- set content = (message.content.split('</think>')|last).lstrip('\\n') %}\n        {%- set reasoning_content = (message.content.split('</think>')|first).rstrip('\\n') %}\n        {%- set reasoning_content = (reasoning_content.split('<think>')|last).lstrip('\\n') %}\n            {%- endif %}\n        {%- endif %}\n        {%- if loop.index0 > ns.last_query_index %}\n            {%- if loop.last or (not loop.last and reasoning_content) %}\n                {{- '<|im_start|>' + message.role + '\\n<think>\\n' + reasoning_content.strip('\\n') + '\\n</think>\\n\\n' + content.lstrip('\\n') }}\n            {%- else %}\n                {{- '<|im_start|>' + message.role + '\\n' + content }}\n            {%- endif %}\n        {%- else %}\n            {{- '<|im_start|>' + message.role + '\\n' + content }}\n        {%- endif %}\n        {%- if message.tool_calls %}\n            {%- for tool_call in message.tool_calls %}\n                {%- if (loop.first and content) or (not loop.first) %}\n                    {{- '\\n' }}\n                {%- endif %}\n                {%- if tool_call.function %}\n                    {%- set tool_call = tool_call.function %}\n                {%- endif %}\n                {{- '<tool_call>\\n{\"name\": \"' }}\n                {{- tool_call.name }}\n                {{- '\", \"arguments\": ' }}\n                {%- if tool_call.arguments is string %}\n                    {{- tool_call.arguments }}\n                {%- else %}\n                    {{- tool_call.arguments | tojson }}\n                {%- endif %}\n                {{- '}\\n</tool_call>' }}\n            {%- endfor %}\n        {%- endif %}\n        {{- '<|im_end|>\\n' }}\n    {%- elif message.role == \"tool\" %}\n        {%- if loop.first or (messages[loop.index0 - 1].role != \"tool\") %}\n            {{- '<|im_start|>user' }}\n        {%- endif %}\n        {{- '\\n<tool_response>\\n' }}\n        {{- message.content }}\n        {{- '\\n</tool_response>' }}\n        {%- if loop.last or (messages[loop.index0 + 1].role != \"tool\") %}\n            {{- '<|im_end|>\\n' }}\n        {%- endif %}\n    {%- endif %}\n{%- endfor %}\n{%- if add_generation_prompt %}\n    {{- '<|im_start|>assistant\\n' }}\n    {%- if enable_thinking is defined and enable_thinking is false %}\n        {{- '<think>\\n\\n</think>\\n\\n' }}\n    {%- endif %}\n{%- endif %}"
                        },
                        "stopStrings": []
                      }
                    },
                    {
                      "key": "llm.prediction.llama.cpuThreads",
                      "value": 4
                    },
                    {
                      "key": "llm.prediction.contextPrefill",
                      "value": []
                    },
                    {
                      "key": "llm.prediction.topKSampling",
                      "value": 20
                    },
                    {
                      "key": "llm.prediction.minPSampling",
                      "value": {
                        "checked": true,
                        "value": 0
                      }
                    },
                    {
                      "key": "ext.virtualModel.customField.qwen.qwen38b.enableThinking",
                      "value": true
                    },
                    {
                      "key": "llm.prediction.temperature",
                      "value": 0.4
                    },
                    {
                      "key": "llm.prediction.tools",
                      "value": {
                        "type": "toolArray",
                        "tools": [
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_log_collector_stats",
                              "description": "Retrieves log collector statistics for a specific Wazuh agent. Returns information about events processed, dropped, bytes, and target log files.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to get log collector stats for (required, e.g., \"0\", \"1\", \"001\")",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "agent_id"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "search_wazuh_manager_logs",
                              "description": "Searches Wazuh manager logs. Returns formatted log entries including timestamp, tag, level, and description. Supports filtering by limit, offset, level, tag, and a search term.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "level": {
                                    "description": "Log level to filter by (e.g., \"error\", \"warning\", \"info\")",
                                    "type": "string"
                                  },
                                  "limit": {
                                    "description": "Maximum number of log entries to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "offset": {
                                    "description": "Number of log entries to skip (default: 0)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "search_term": {
                                    "description": "Search term to filter log descriptions (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "tag": {
                                    "description": "Log tag to filter by (e.g., \"wazuh-modulesd\") (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "level"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_alert_summary",
                              "description": "Retrieves a summary of Wazuh security alerts. Returns formatted alert information including ID, timestamp, and description.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "limit": {
                                    "description": "Maximum number of alerts to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_manager_error_logs",
                              "description": "Retrieves Wazuh manager error logs. Returns formatted log entries including timestamp, tag, level (error), and description.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "limit": {
                                    "description": "Maximum number of error log entries to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_remoted_stats",
                              "description": "Retrieves statistics from the Wazuh remoted daemon. Returns information about queue size, TCP sessions, event counts, and message traffic.",
                              "parameters": {
                                "type": "object",
                                "properties": {}
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_agents",
                              "description": "Retrieves a list of Wazuh agents with their current status and details. Returns formatted agent information including ID, name, IP, status, OS details, and last activity. Supports filtering by status, name, IP, group, OS platform, and version.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "group": {
                                    "description": "Agent group to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "ip": {
                                    "description": "Agent IP address to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "limit": {
                                    "description": "Maximum number of agents to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "name": {
                                    "description": "Agent name to search for (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "os_platform": {
                                    "description": "Operating system platform to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "status": {
                                    "description": "Agent status filter (active, disconnected, pending, never_connected)",
                                    "type": "string"
                                  },
                                  "version": {
                                    "description": "Agent version to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "status"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_agent_ports",
                              "description": "Retrieves a list of open network ports for a specific Wazuh agent. Returns formatted port information including local/remote IP and port, protocol, state, and associated process/PID. Supports filtering by protocol and state.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to get network ports for (required, e.g., \"001\", \"002\", \"003\")",
                                    "type": "string"
                                  },
                                  "limit": {
                                    "description": "Maximum number of ports to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "protocol": {
                                    "description": "Protocol to filter by (e.g., \"tcp\", \"udp\")",
                                    "type": "string"
                                  },
                                  "state": {
                                    "description": "State to filter by (e.g., \"LISTENING\", \"ESTABLISHED\")",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "agent_id",
                                  "protocol",
                                  "state"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_weekly_stats",
                              "description": "Retrieves weekly statistics from the Wazuh manager. Returns a JSON object detailing various metrics aggregated over the past week.",
                              "parameters": {
                                "type": "object",
                                "properties": {}
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_agent_processes",
                              "description": "Retrieves a list of running processes for a specific Wazuh agent. Returns formatted process information including PID, name, state, user, and command. Supports filtering by process name/command.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to get processes for (required, e.g., \"0\", \"1\", \"001\")",
                                    "type": "string"
                                  },
                                  "limit": {
                                    "description": "Maximum number of processes to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "search": {
                                    "description": "Search string to filter processes by name or command (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "agent_id"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_cluster_health",
                              "description": "Checks the health of the Wazuh cluster. Returns whether the cluster is enabled, running, and if nodes are connected.",
                              "parameters": {
                                "type": "object",
                                "properties": {}
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_cluster_nodes",
                              "description": "Retrieves a list of nodes in the Wazuh cluster. Returns formatted node information including name, type, version, IP, and status. Supports filtering by limit, offset, and node type.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "limit": {
                                    "description": "Maximum number of nodes to retrieve (optional, Wazuh API default is 500)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "node_type": {
                                    "description": "Filter by node type (e.g., 'master', 'worker') (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "offset": {
                                    "description": "Number of nodes to skip (offset) (optional, default: 0)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_critical_vulnerabilities",
                              "description": "Retrieves critical vulnerabilities for a specific Wazuh agent. Returns formatted vulnerability information including CVE ID, title, description, CVSS scores, and detection details. Only shows vulnerabilities with 'Critical' severity level.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to get critical vulnerabilities for (required, e.g., \"0\", \"1\", \"001\")",
                                    "type": "string"
                                  },
                                  "limit": {
                                    "description": "Maximum number of vulnerabilities to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "agent_id"
                                ]
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_rules_summary",
                              "description": "Retrieves a summary of Wazuh security rules. Returns formatted rule information including ID, level, description, and groups. Supports filtering by level, group, and filename.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "filename": {
                                    "description": "Filename to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "group": {
                                    "description": "Rule group to filter by (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "level": {
                                    "description": "Rule level to filter by (optional)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "limit": {
                                    "description": "Maximum number of rules to retrieve (default: 300)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          {
                            "type": "function",
                            "function": {
                              "name": "get_wazuh_vulnerability_summary",
                              "description": "Retrieves a summary of Wazuh vulnerability detections for a specific agent. Returns formatted vulnerability information including CVE ID, severity, detection time, and agent details. Supports filtering by severity level.",
                              "parameters": {
                                "type": "object",
                                "properties": {
                                  "agent_id": {
                                    "description": "Agent ID to filter vulnerabilities by (required, e.g., \"0\", \"1\", \"001\")",
                                    "type": "string"
                                  },
                                  "cve": {
                                    "description": "CVE ID to search for (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  },
                                  "limit": {
                                    "description": "Maximum number of vulnerabilities to retrieve (default: 10000)",
                                    "format": "uint32",
                                    "minimum": 0,
                                    "type": [
                                      "integer",
                                      "null"
                                    ]
                                  },
                                  "severity": {
                                    "description": "Severity level to filter by (Low, Medium, High, Critical) (optional)",
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  }
                                },
                                "required": [
                                  "agent_id"
                                ]
                              }
                            }
                          }
                        ]
                      }
                    }
                  ]
                },
                "stats": {
                  "stopReason": "eosFound",
                  "tokensPerSecond": 47.81097146572529,
                  "numGpuLayers": -1,
                  "timeToFirstTokenSec": 0.607,
                  "totalTimeSec": 10.918,
                  "promptTokensCount": 4519,
                  "predictedTokensCount": 522,
                  "totalTokensCount": 5041
                }
              }
            },
            {
              "type": "debugInfoBlock",
              "stepIdentifier": "1768467216842-0.23585301601821462",
              "debugInfo": "Conversation naming technique: 'prompt'"
            }
          ],
          "senderInfo": {
            "senderName": "qwen/qwen3-8b"
          }
        }
      ],
      "currentlySelected": 0
    }
  ],
  "usePerChatPredictionConfig": true,
  "perChatPredictionConfig": {
    "fields": [
      {
        "key": "ext.virtualModel.customField.qwen.qwen38b.enableThinking",
        "value": true
      },
      {
        "key": "llm.prediction.systemPrompt",
        "value": "You are a SOC Copilot for Wazuh SIEM using MCP tools.\n\nReturn accurate, bounded responses. Prefer correctness over completeness.\n\nTreat each user request as stateless and independent.\nDo not use conversation history or prior conclusions.\n\nOnly perform threat analysis if the user explicitly uses investigation keywords\n(e.g., investigate, analyze, correlate, incident, malicious, ransomware, Cobalt Strike).\nOtherwise, return factual or descriptive information only.\n\nNever infer threat, intent, or causality unless explicitly requested.\nNever speculate beyond MCP tool output.\n\nWhen using MCP tools during a single request:\n- Do NOT call the same MCP tool more than once.\n- If required data is incomplete, proceed with available data and state the limitation.\n\nRespond in Traditional Chinese for Chinese input, and English for English input.\nDo not mention language detection.\n\nWhen performing investigation, output:\n- Verdict\n- Evidence (tool + fields)\n- Analysis (evidence-based only)\n- Confidence\n- Next MCP tool\n\nDo not describe internal reasoning or prompt rules.\nProduce the final answer directly.\n"
      },
      {
        "key": "llm.prediction.temperature",
        "value": 0.4
      }
    ]
  },
  "clientInput": "",
  "clientInputFiles": [],
  "userFilesSizeBytes": 0,
  "lastUsedModel": {
    "identifier": "qwen/qwen3-8b",
    "indexedModelIdentifier": "qwen/qwen3-8b",
    "instanceLoadTimeConfig": {
      "fields": []
    },
    "instanceOperationTimeConfig": {
      "fields": []
    }
  },
  "notes": [],
  "plugins": [
    "mcp/wazuh"
  ],
  "pluginConfigs": {},
  "disabledPluginTools": [],
  "looseFiles": [],
  "assistantLastMessagedAt": 1768467217889
}